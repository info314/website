<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Daniel Schwalbe">
        <link rel="canonical" href="https://info314.giantfirewall.com/resources/ssh-agent/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Using ssh-agent - INFO 314 Course Resources</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/color-brewer.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">INFO 314 Course Resources</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Projects <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">1 - Pi Setup</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../assignments/pi-setup/" class="dropdown-item">Raspberry Pi Setup</a>
</li>
            
<li>
    <a href="../../assignments/networkd-setup/" class="dropdown-item">networkd Setup</a>
</li>
            
<li>
    <a href="../wifi-reference/" class="dropdown-item">Wifi Reference</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">2 - Set up a DHCP Server</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../assignments/dhcp-setup/" class="dropdown-item">Installing and Configuring the ISC DHCP Server</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">3 - Configure Routing and NAT</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../assignments/router-setup/" class="dropdown-item">Router Setup</a>
</li>
            
<li>
    <a href="../iptables/" class="dropdown-item">Introduction to iptables</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">4 - Configure a DNS Resolver</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../assignments/resolver-setup/" class="dropdown-item">DNS Resolver Setup</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">5 - Extra Credit - Build a Pi-Hole (Optional)</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../assignments/pihole-project-1/" class="dropdown-item">Part 1 - Installing the Raspberry Pi OS</a>
</li>
            
<li>
    <a href="../../assignments/pihole-project-2/" class="dropdown-item">Part 2 - Installing the Pi-Hole Application</a>
</li>
            
<li>
    <a href="../../assignments/pihole-project-3/" class="dropdown-item">Part 3 - Installing the recursive DNS Server</a>
</li>
            
<li>
    <a href="../../assignments/pihole-project-4/" class="dropdown-item">Part 4 - Make Pi-Hole work for you!</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Labs <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../assignments/lab1/" class="dropdown-item">Lab 1 - Core Technical Skills</a>
</li>
                                    
<li>
    <a href="../../assignments/lab2/" class="dropdown-item">Lab 2 - Analyze DNS & HTTP in Wireshark</a>
</li>
                                    
<li>
    <a href="../../assignments/lab3/" class="dropdown-item">Lab 3 - Analyzing DHCP and ARP with Wireshark</a>
</li>
                                    
<li>
    <a href="../../assignments/lab4/" class="dropdown-item">Lab 4 - Analyze Zeroconf in Wireshark</a>
</li>
                                    
<li>
    <a href="../../assignments/lab5/" class="dropdown-item">Lab 5 - Analyze TCP with ncat and Wireshark</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Resources <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Concepts and Theory</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../notes/dns-overview/" class="dropdown-item">Domain Name System (DNS)</a>
</li>
            
<li>
    <a href="../../notes/router-overview/" class="dropdown-item">Routers</a>
</li>
            
<li>
    <a href="../../notes/ethernet-switches/" class="dropdown-item">Ethernet Switches</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Guides</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../pi-materials/" class="dropdown-item">Getting Pi Materials</a>
</li>
            
<li>
    <a href="../digital-ocean/" class="dropdown-item">Digital Ocean Signup</a>
</li>
            
<li>
    <a href="../address-planning/" class="dropdown-item">Basic IP Address Planning</a>
</li>
            
<li>
    <a href="../iptables/" class="dropdown-item">Introduction to Iptables</a>
</li>
            
<li>
    <a href="../netfilter-hooks/" class="dropdown-item">Understanding Netfilter/Iptables Hooks</a>
</li>
            
<li>
    <a href="../wifi-reference/" class="dropdown-item">Linux Wireless Configuration</a>
</li>
            
<li>
    <a href="../zone-file-format/" class="dropdown-item">Zone File Reference</a>
</li>
            
<li>
    <a href="../vlans-and-dummies/" class="dropdown-item">Special Network Interfaces (VLANs and Dummies)</a>
</li>
            
<li>
    <a href="../configure-routing-links/" class="dropdown-item">Configuring Routing Links</a>
</li>
            
<li>
    <a href="../setup-wireguard/" class="dropdown-item">Install and Configure WireGuard</a>
</li>
            
<li>
    <a href="../setup-frr/" class="dropdown-item">Install Free Range Routing (FRR)</a>
</li>
            
<li>
    <a href="./" class="dropdown-item active">Using ssh-agent</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Configure an Authoritative Name Server</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../assignments/dns-zone-setup/" class="dropdown-item">Authoritative Zone Setup</a>
</li>
            
<li>
    <a href="../zone-file-format/" class="dropdown-item">DNS Zone Reference</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Quick Reference</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../markdown/" class="dropdown-item">Intro to Markdown</a>
</li>
            
<li>
    <a href="../bash/" class="dropdown-item">Intro to Bash</a>
</li>
            
<li>
    <a href="../host-config/" class="dropdown-item">Mac/Win/Linux Networking</a>
</li>
            
<li>
    <a href="../wireshark-install/" class="dropdown-item">Install Wireshark</a>
</li>
            
<li>
    <a href="../tshark-install/" class="dropdown-item">Install TShark</a>
</li>
            
<li>
    <a href="../manage-dhcp/" class="dropdown-item">Troubleshooting DHCP</a>
</li>
            
<li>
    <a href="../dns-clients/" class="dropdown-item">Managing DNS Clients</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../../contact/" class="nav-link">Contact Us</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../setup-frr/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../../assignments/dns-zone-setup/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/info314/website" class="nav-link">info314/website</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#using-the-ssh-agent-to-manage-login-keys" class="nav-link">Using the SSH Agent to Manage Login Keys</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#configuring-ssh-agent-for-macos" class="nav-link">Configuring ssh-agent for macOS</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#configuring-ssh-agent-for-windows-10" class="nav-link">Configuring ssh-agent for Windows 10</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="using-the-ssh-agent-to-manage-login-keys">Using the SSH Agent to Manage Login Keys<a class="headerlink" href="#using-the-ssh-agent-to-manage-login-keys" title="Permanent link">&para;</a></h1>
<p>SSH keys can provide a notable improvement over password-based security (with
respect to certain threats), but they are not without inconvenience or risk.
Most notably, if we don't use encryption with strong passphrases to keys on 
disk, an intruder or piece of malware can more easily retrieve our keys and 
use them to access any resources we are permitted to access. Moreover, when we 
encrypt our private keys, we face the potential inconvenience of supplying the 
passphrase each time we run <code>ssh</code>.</p>
<p>To ease the burden of using keys in the proper manner, OpenSSH provides a 
helper service, i.e., <code>ssh-agent</code>, to help you manage your private keys. Once 
an identity has been added to the <code>ssh-agent</code>, the agent can use the private 
key to log into servers without requiring you to enter a password for the 
the server or supply the key's passphrase.</p>
<p>The <code>ssh-agent</code> helper is available for both macOS and Windows 10 (as well as 
Linux), but the configuration process varies for each system. By following 
the instructions provided in this guide when you first set up your private 
keys, you'll be able to take advantage of the security improvements offered 
by key-based SSH authentication with OpenSSH on your macOS or Windows 10 device.</p>
<h2 id="configuring-ssh-agent-for-macos">Configuring <code>ssh-agent</code> for macOS<a class="headerlink" href="#configuring-ssh-agent-for-macos" title="Permanent link">&para;</a></h2>
<ol>
<li>Configure OpenSSH to work with <code>ssh-agent</code> and macOS KeyChain</li>
<li>Launch the <code>ssh-agent</code> as a background service.</li>
<li>Use <code>ssh-add</code> to load your keys into the agent.</li>
</ol>
<h3 id="step-1">Step 1<a class="headerlink" href="#step-1" title="Permanent link">&para;</a></h3>
<p>Edit or create <code>~/.ssh/config</code> so that <code>ssh-agent</code> and macOS KeyChain are used automatically to manage private keys and passphrases. This configuration is required by the version of <code>ssh</code> distributed by Apple since macOS Sierra 10.12.2. </p>
<pre class="highlight"><code>Host *
    AddKeysToAgent yes
    UseKeyChain yes</code></pre>
<h3 id="step-2">Step 2<a class="headerlink" href="#step-2" title="Permanent link">&para;</a></h3>
<p>Launch the <code>ssh-agent</code> as a background service.
<pre class="highlight"><code class="language-bash"># The eval $() syntax is used to update the current environment based on the output of the ssh-agent command
$ eval "$(ssh-agent -s)"</code></pre></p>
<p>Add your key to the <code>ssh-agent</code> using the <code>ssh-add</code> utility. </p>
<h3 id="step-3">Step 3<a class="headerlink" href="#step-3" title="Permanent link">&para;</a></h3>
<pre class="highlight"><code class="language-bash"># The -K option is required for some versions of macOS. Omit if it returns an error.
ssh-add -K ~/.ssh/id_ed25519

# Check that your key is loaded by listing current keys in the agent
ssh-add -l</code></pre>
<h2 id="configuring-ssh-agent-for-windows-10">Configuring <code>ssh-agent</code> for Windows 10<a class="headerlink" href="#configuring-ssh-agent-for-windows-10" title="Permanent link">&para;</a></h2>
<ol>
<li>Enable the <code>ssh-agent</code> Windows Service (disabled by default).</li>
<li>Configure Powershell to launch <code>ssh-agent</code> when you open a console.</li>
<li>Use <code>ssh-add</code> to load your keys into the agent.</li>
</ol>
<h3 id="step-1_1">Step 1<a class="headerlink" href="#step-1_1" title="Permanent link">&para;</a></h3>
<p>Launch Powershell <strong>with administrator privileges</strong> and set the startup mode for the <code>ssh-agent</code> service to <code>Manual</code> since it is configured by default as <code>Disabled</code>.</p>
<pre class="highlight"><code class="language-powershell">Set-Service -Name ssh-agent -StartupType Manual</code></pre>
<h3 id="step-2_1">Step 2<a class="headerlink" href="#step-2_1" title="Permanent link">&para;</a></h3>
<p>Open a <strong>normal (non-administrator)</strong> Powershell console and edit/create a profile script to automatically launch the <code>ssh-agent</code> service. </p>
<p>In order to do this, we need to enable the ability to run basic scripts on the system and then find the location of the script (automatically assigned by Windows to the <code>$PROFILE</code> variable).</p>
<pre class="highlight"><code class="language-powershell"># Modify Powershell policy to allow basic powershell scripts to run
# This command may prompt you with a security warning. Press "Yes" if it does.
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser

# Test whether the profile script exists
Test-Path $PROFILE

# If the previous command returns False, create the file
New-Item -path $PROFILE -type file -force

# Launch Notepad.exe to create a script
notepad.exe $PROFILE</code></pre>
<p>Use Notepad to add the following code to your profile script. This will be run each time you launch a new console.
<pre class="highlight"><code class="language-powershell"># Launch the service if it's not already running
$agentService = Get-Service -Name ssh-agent
if ($agentService.Status -ne "Running") {
  Start-Service -Name ssh-agent
}</code></pre></p>
<h3 id="step-3_1">Step 3<a class="headerlink" href="#step-3_1" title="Permanent link">&para;</a></h3>
<p>Open a fresh Powershell console and add your keys to the agent.
<pre class="highlight"><code class="language-powershell"># Add the private key to the ssh-agent
ssh-add $HOME\.ssh\id_ed25519

# Check that your key is loaded by listing current keys in the agent
ssh-add -l</code></pre></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2020 Daniel Schwalbe</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
