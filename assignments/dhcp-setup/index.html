<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Daniel Schwalbe">
        <link rel="canonical" href="https://info314.giantfirewall.com/assignments/dhcp-setup/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Installing and Configuring the ISC DHCP Server - INFO 314 Course Resources</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/color-brewer.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">INFO 314 Course Resources</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Projects <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">1 - Pi Setup</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../pi-setup/" class="dropdown-item">Raspberry Pi Setup</a>
</li>
            
<li>
    <a href="../networkd-setup/" class="dropdown-item">networkd Setup</a>
</li>
            
<li>
    <a href="../../resources/wifi-reference/" class="dropdown-item">Wifi Reference</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">2 - Set up a DHCP Server</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="./" class="dropdown-item active">Installing and Configuring the ISC DHCP Server</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Labs <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../lab1/" class="dropdown-item">Lab 1 - Core Technical Skills</a>
</li>
                                    
<li>
    <a href="../lab2/" class="dropdown-item">Lab 2 - Analyze DNS & HTTP in Wireshark</a>
</li>
                                    
<li>
    <a href="../lab3/" class="dropdown-item">Lab 3 - Analyzing DHCP and ARP with Wireshark</a>
</li>
                                    
<li>
    <a href="../lab4/" class="dropdown-item">Lab 4 - Analyze Zeroconf in Wireshark</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Resources <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Concepts and Theory</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../notes/dns-overview/" class="dropdown-item">Domain Name System (DNS)</a>
</li>
            
<li>
    <a href="../../notes/router-overview/" class="dropdown-item">Routers</a>
</li>
            
<li>
    <a href="../../notes/ethernet-switches/" class="dropdown-item">Ethernet Switches</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Guides</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../resources/pi-materials/" class="dropdown-item">Getting Pi Materials</a>
</li>
            
<li>
    <a href="../../resources/digital-ocean/" class="dropdown-item">Digital Ocean Signup</a>
</li>
            
<li>
    <a href="../../resources/address-planning/" class="dropdown-item">Basic IP Address Planning</a>
</li>
            
<li>
    <a href="../../resources/wifi-reference/" class="dropdown-item">Linux Wireless Configuration</a>
</li>
            
<li>
    <a href="../../resources/ssh-agent/" class="dropdown-item">Using ssh-agent</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Quick Reference</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../resources/markdown/" class="dropdown-item">Intro to Markdown</a>
</li>
            
<li>
    <a href="../../resources/bash/" class="dropdown-item">Intro to Bash</a>
</li>
            
<li>
    <a href="../../resources/host-config/" class="dropdown-item">Mac/Win/Linux Networking</a>
</li>
            
<li>
    <a href="../../resources/wireshark-install/" class="dropdown-item">Install Wireshark</a>
</li>
            
<li>
    <a href="../../resources/tshark-install/" class="dropdown-item">Install TShark</a>
</li>
            
<li>
    <a href="../../resources/manage-dhcp/" class="dropdown-item">Troubleshooting DHCP</a>
</li>
            
<li>
    <a href="../../resources/dns-clients/" class="dropdown-item">Managing DNS Clients</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../../contact/" class="nav-link">Contact Us</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../../resources/wifi-reference/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../lab1/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/info314/website" class="nav-link">info314/website</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#set-up-a-dhcp-server-for-your-lan" class="nav-link">Set up a DHCP Server for your LAN</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#overview" class="nav-link">Overview</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#before-you-start" class="nav-link">Before you Start</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#configure-static-addresses-for-your-raspberry-pi" class="nav-link">Configure Static Addresses for your Raspberry Pi</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#install-and-configure-dhcp" class="nav-link">Install and Configure DHCP</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#test-dhcp-server" class="nav-link">Test DHCP Server</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#troubleshooting" class="nav-link">Troubleshooting</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="set-up-a-dhcp-server-for-your-lan">Set up a DHCP Server for your LAN<a class="headerlink" href="#set-up-a-dhcp-server-for-your-lan" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>In this assignment, we'll be standing up a DHCP service on the Raspberry Pi. As we've discussed in class, DHCP is a function that is sometimes performed by routers and is a necessary service whenever we are creating a new network (of almost any type). </p>
<h2 id="before-you-start">Before you Start<a class="headerlink" href="#before-you-start" title="Permanent link">&para;</a></h2>
<p>Before starting any of the work within this checkpoint, make sure that you have completed all steps from checkpoint one, including the <strong>networkd</strong> setup.</p>
<p>You must also have completed the <strong>Address Planning Exercise</strong> correctly. You will use the parameters you selected in that exercise to configure the IP address for the Pi as well as the configuration for <strong>isc-dhcp-server</strong>.</p>
<h2 id="configure-static-addresses-for-your-raspberry-pi">Configure Static Addresses for your Raspberry Pi<a class="headerlink" href="#configure-static-addresses-for-your-raspberry-pi" title="Permanent link">&para;</a></h2>
<p>In this step, you will add a new configuration file to <strong>networkd</strong> in order to set up static addresses on <strong>eth0</strong>. The addresses you use here will be the one you defined for your <strong>DHCP Server</strong> and <strong>Default Gateway</strong> in the <strong>LAN Planning Exercise</strong>.</p>
<div class="admonition danger">
<p class="admonition-title">Please do not try to follow other tutorials for setting up addresses</p>
<p>Every quarter, we have students who choose to follow online tutorials instead of the instructions we've provided. Please be aware that we are not using the default Raspberry Pi networking. These tutorials will often instruct you to configure static addresses in the <code>/etc/dhcpcd.conf</code> file or <code>/etc/network/interfaces</code>. Both of these methods were disabled when we set up <strong>networkd</strong>.</p>
</div>
<p>Create a file named <code>20-eth0.network</code> in  <code>/etc/systemd/network/</code> (you'll need to use <code>sudo</code>) and define a static configuration that includes your chosen IP address and CIDR range. This path should already contain a default configuration for ethernet interfaces, e.g., <code>99-eth.network</code>. We are overriding this configuration for <code>eth0</code> by naming the file in such a way that <strong>networkd</strong> will load it first (<strong>networkd</strong> processes these files in number order; lower number = loaded first) and by ensuring that the configuration will match <code>eth0</code> exactly.</p>
<p>Your file should look something like:</p>
<pre class="highlight"><code># We only want to match the eth0 wired ethernet interface:

[Match]
Name=eth0

# Here we define the static IPv4 address of the RPi that you 
# selected in your LAN Plan. It is written in CIDR notation.
# 10.10.10.5/25 is only an example. Replace it with the IP
# you selected for your RPi in your plan:

[Network]
Address=10.10.10.5/25

# Enable link local addresses for IPv6 (FE80::) - this is important
LinkLocalAddressing=ipv6</code></pre>
<div class="admonition warning important">
<p class="admonition-title">Warning</p>
<p>Some online references will have you add a gateway and DNS settings for your new interface. You don't need to (and definitely shouldn't) add either to this interface. </p>
<p>This interface does not provide a path for Internet traffic, but your Pi will try to use it that way if it believes it can be used for a default route.</p>
<p>Likewise, we don't need to give the Pi DNS settings on Ethernet. The Pi will get it’s DNS from the wireless interface, which received it’s DNS settings from DHCP. </p>
</div>
<p>In order to test these new settings:</p>
<p>Call <code>sudo systemctl restart systemd-networkd.service</code> <strong>or</strong> reboot your Pi.</p>
<p>Once you log back in, verify that <code>networkd</code> is running by calling <code>systemctl status systemd-networkd</code> and use the <code>ip addr</code> command to check that <code>eth0</code> is online with the new address.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Make note that the Pi is now assigned to our new subnet, but our computer will still be using it's autoconfigured IPv4 address in the 169.254/16 range.</p>
<p>In an IPv4 only world, this would prevent us from talking to the Pi. To fix the problem, we'd have to manually configure a static IP on our laptop in the same range as the Pi's network ID.</p>
<p>Fortunately, both devices have autoconfigured IPv6 addresses that will be discovered through mDNS. By default, this is the address that SSH will use.</p>
</div>
<h2 id="install-and-configure-dhcp">Install and Configure DHCP<a class="headerlink" href="#install-and-configure-dhcp" title="Permanent link">&para;</a></h2>
<p>For this part of the exercise, we'll use the ISC DHCP Server. The ISC server is available in <code>apt</code> repositories, so it can be installed using:</p>
<pre class="highlight"><code class="language-bash">sudo apt update
sudo apt install isc-dhcp-server</code></pre>
<div class="admonition warning important">
<p class="admonition-title">Warning</p>
<p>Right after installation, isc-dhcp-server will report that it failed to run, and spit out lots of nasty-looking errors. This is normal, as the DHCP server has not yet been configured.</p>
</div>
<p>Edit <code>/etc/default/isc-dhcp-server</code> to specify the interfaces (<code>eth0</code> only) on which to run the DHCP server. Comment out any options pertaining to DHCP for IPv6.</p>
<p>The stock DHCP configuration is located at <code>/etc/dhcp/dhcpd.conf</code>. This file contains a number of example <code>subnet</code> declarations that you are meant to pick and choose from in order to configure the DHCP server and to distribute addresses within your predefined address range. For this assignment, our configuration is quite minimal:</p>
<div class="admonition instructions">
<p class="admonition-title">Specifications</p>
<p>Before you start to configure your subnet, comment out the lines near the top of the file that specify global settings for nameservers and domain (we won’t use them right now).</p>
<ul>
<li>Create a new subnet configuration block using the network ID and network mask you established in the <em>LAN Planning Exercise</em>.</li>
<li>Inside the subnet block, define a contiguous <code>range</code> of IP addresses for the DHCP pool out of the address range selected in the <em>LAN Planning Exercise</em>.</li>
<li>You may browse the othe options available, but at this point you should not specify anything other than the DHCP lease range.</li>
</ul>
</div>
<div class="admonition faq">
<p class="admonition-title">Why don't we configure the default gateway or name servers yet?</p>
<p>Students will frequently jump ahead and fill in additional network parameters. The reason we don't want to include these parameters yet is that our Pi is not yet ready to provide an Internet connection. Sending a default route back to your laptop will create a black hole of sorts for Internet traffic. Your computer will try to route the traffic through the Pi, and the Pi will simply drop everything it receives.</p>
</div>
<h2 id="test-dhcp-server">Test DHCP Server<a class="headerlink" href="#test-dhcp-server" title="Permanent link">&para;</a></h2>
<p>Use <code>systemctl</code> to restart the DHCP service as shown here:</p>
<p><code>sudo systemctl restart isc-dhcp-server.service</code></p>
<p>If you see errors such as the one shown here, you’ll need to continue troubleshooting the DHCP server (see next section).</p>
<pre class="highlight"><code>pi@titan:~ $ sudo systemctl restart isc-dhcp-server.service
Job for isc-dhcp-server.service failed because the control process exited with error code.
See "systemctl status isc-dhcp-server.service" and "journalctl -xe" for details.</code></pre>
<p>Check your local machine to confirm that an IP address in the specified network range was provided. You may need to use your OS specific tools or CLI commands to request a new DHCP lease on the wired ethernet interface (see <a href="/resources/manage-dhcp/">troubleshooting DHCP for help)</a>.</p>
<p>Try running <code>ping</code> from both directions (laptop -&gt; pi and pi -&gt; laptop) to confirm that the IP address and related settings are configured correctly.</p>
<div class="admonition warning important">
<p class="admonition-title">Warning</p>
<p>If you are on Windows, incoming <code>ping</code> requests (those from pi -&gt; laptop) will not get any response. This is because by default Windows Firewall blocks these requests from being answered. To disable this, run a PowerShell prompt as Administrator and enter these commands:
<pre class="highlight"><code>New-NetFirewallRule -DisplayName "Allow inbound ICMPv4" -Direction Inbound -Protocol ICMPv4 -IcmpType 8 -Action Allow
</code></pre></p>
<pre class="highlight"><code>
New-NetFirewallRule -DisplayName "Allow inbound ICMPv6" -Direction Inbound -Protocol ICMPv6 -IcmpType 8 -Action Allow</code></pre>
</div>
<h2 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link">&para;</a></h2>
<p>Troubleshooting for the ISC DHCP Server can be found under <a href="/resources/manage-dhcp/">troubleshooting DHCP</a>.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2020 Daniel Schwalbe</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
