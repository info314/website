<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Daniel Schwalbe">
        <link rel="canonical" href="https://info314.giantfirewall.com/assignments/resolver-setup/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>DNS Resolver Setup - INFO 314 Course Resources</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/color-brewer.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">INFO 314 Course Resources</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Projects <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">1 - Pi Setup</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../pi-setup/" class="dropdown-item">Raspberry Pi Setup</a>
</li>
            
<li>
    <a href="../networkd-setup/" class="dropdown-item">networkd Setup</a>
</li>
            
<li>
    <a href="../../resources/wifi-reference/" class="dropdown-item">Wifi Reference</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">2 - Set up a DHCP Server</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../dhcp-setup/" class="dropdown-item">Installing and Configuring the ISC DHCP Server</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">3 - Configure Routing and NAT</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../router-setup/" class="dropdown-item">Router Setup</a>
</li>
            
<li>
    <a href="../../resources/iptables/" class="dropdown-item">Introduction to iptables</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">4 - Configure a DNS Resolver</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="./" class="dropdown-item active">DNS Resolver Setup</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Optional - Configure an Authoritative Name Server</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../dns-zone-setup/" class="dropdown-item">Authoritative Zone Setup</a>
</li>
            
<li>
    <a href="../../resources/zone-file-format/" class="dropdown-item">DNS Zone Reference</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Labs <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../lab1/" class="dropdown-item">Lab 1 - Core Technical Skills</a>
</li>
                                    
<li>
    <a href="../lab2/" class="dropdown-item">Lab 2 - Analyze DNS & HTTP in Wireshark</a>
</li>
                                    
<li>
    <a href="../lab3/" class="dropdown-item">Lab 3 - Analyzing DHCP and ARP with Wireshark</a>
</li>
                                    
<li>
    <a href="../lab4/" class="dropdown-item">Lab 4 - Analyze Zeroconf in Wireshark</a>
</li>
                                    
<li>
    <a href="../lab5/" class="dropdown-item">Lab 5 - Analyze TCP with ncat and Wireshark</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Resources <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Concepts and Theory</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../notes/dns-overview/" class="dropdown-item">Domain Name System (DNS)</a>
</li>
            
<li>
    <a href="../../notes/router-overview/" class="dropdown-item">Routers</a>
</li>
            
<li>
    <a href="../../notes/ethernet-switches/" class="dropdown-item">Ethernet Switches</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Guides</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../resources/pi-materials/" class="dropdown-item">Getting Pi Materials</a>
</li>
            
<li>
    <a href="../../resources/digital-ocean/" class="dropdown-item">Digital Ocean Signup</a>
</li>
            
<li>
    <a href="../../resources/address-planning/" class="dropdown-item">Basic IP Address Planning</a>
</li>
            
<li>
    <a href="../../resources/iptables/" class="dropdown-item">Introduction to Iptables</a>
</li>
            
<li>
    <a href="../../resources/netfilter-hooks/" class="dropdown-item">Understanding Netfilter/Iptables Hooks</a>
</li>
            
<li>
    <a href="../../resources/wifi-reference/" class="dropdown-item">Linux Wireless Configuration</a>
</li>
            
<li>
    <a href="../../resources/zone-file-format/" class="dropdown-item">Zone File Reference</a>
</li>
            
<li>
    <a href="../../resources/vlans-and-dummies/" class="dropdown-item">Special Network Interfaces (VLANs and Dummies)</a>
</li>
            
<li>
    <a href="../../resources/configure-routing-links/" class="dropdown-item">Configuring Routing Links</a>
</li>
            
<li>
    <a href="../../resources/setup-wireguard/" class="dropdown-item">Install and Configure WireGuard</a>
</li>
            
<li>
    <a href="../../resources/setup-frr/" class="dropdown-item">Install Free Range Routing (FRR)</a>
</li>
            
<li>
    <a href="../../resources/ssh-agent/" class="dropdown-item">Using ssh-agent</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Quick Reference</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../resources/markdown/" class="dropdown-item">Intro to Markdown</a>
</li>
            
<li>
    <a href="../../resources/bash/" class="dropdown-item">Intro to Bash</a>
</li>
            
<li>
    <a href="../../resources/host-config/" class="dropdown-item">Mac/Win/Linux Networking</a>
</li>
            
<li>
    <a href="../../resources/wireshark-install/" class="dropdown-item">Install Wireshark</a>
</li>
            
<li>
    <a href="../../resources/tshark-install/" class="dropdown-item">Install TShark</a>
</li>
            
<li>
    <a href="../../resources/manage-dhcp/" class="dropdown-item">Troubleshooting DHCP</a>
</li>
            
<li>
    <a href="../../resources/dns-clients/" class="dropdown-item">Managing DNS Clients</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../../contact/" class="nav-link">Contact Us</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../../resources/iptables/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../dns-zone-setup/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/info314/website" class="nav-link">info314/website</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#personal-recursive-dns-resolver" class="nav-link">Personal Recursive DNS Resolver</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#overview" class="nav-link">Overview</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#before-you-start" class="nav-link">Before you start</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#instructions" class="nav-link">Instructions</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="personal-recursive-dns-resolver">Personal Recursive DNS Resolver<a class="headerlink" href="#personal-recursive-dns-resolver" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>In this assignment, we'll continue to extend the functionality of the Linux-based router by installing and configuring the open source BIND server to resolve DNS requests on behalf of hosts on your LAN. This new functionality will take the place of the public DNS resolvers we used in the previous assignments (e.g., <code>1.1.1.1</code>, <code>8.8.8.8</code>, <code>75.75.75.75</code> etc.).</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>With each checkpoint, we expect you to do more of the work on your own. While the initial Pi setup gave clear instructions, we are slowly moving toward giving you specifications and additional context that you need in order to determine the right steps to accomplish the task.</p>
<p>In this assignment, you will use an <a href="https://www.digitalocean.com/community/tutorials/how-to-configure-bind-as-a-caching-or-forwarding-dns-server-on-ubuntu-16-04">existing tutorial</a> as a reference to <strong>help</strong> you complete the project specifications. Please note that you will not follow the tutorial verbatim, but instead make adjustments based on the project requirements.</p>
<p>For some students, this can be a challenging adjustment, but it is also a valuable skill to learn and practice as you prepare for technical internships and jobs.</p>
</div>
<h2 id="before-you-start">Before you start<a class="headerlink" href="#before-you-start" title="Permanent link">&para;</a></h2>
<p>Before you begin, make sure that you have completed all steps through Checkpoint #3 successfully. At this point, your Pi should operate as a NAT-router between the Ethernet LAN and a Wifi-based WAN. Likewise, DHCP is configured to provide LAN clients with a full network configuration, including a default gateway and a public DNS resolver.</p>
<p>At times in this project, you will need to refer back to the configuration you defined in the previous <strong>LAN Planning Exercise</strong>. </p>
<h2 id="instructions">Instructions<a class="headerlink" href="#instructions" title="Permanent link">&para;</a></h2>
<h3 id="reviewupdate-your-ip-address-plan">Review/Update your IP Address Plan<a class="headerlink" href="#reviewupdate-your-ip-address-plan" title="Permanent link">&para;</a></h3>
<p>Since we will be running our DNS resolver inside our LAN, we will need to provide it with an IP address on <em>eth0</em>. Choose an unused static address from the ranges you defined in your initial LAN Planning. </p>
<p>Before you can assign this address to a service, you will need to add another <code>Address=</code> line to your <em>eth0</em> configuration in <em>systemd-networkd</em>. Further instructions were provided in <a href="../dhcp-setup/#configure-static-addresses-for-your-raspberry-pi">Checkpoint #2</a>.</p>
<p>While it may not be clear at this point, there are sometimes benefits to using separate addresses for different services (in real-world scenarios) even though they're all running on the same device and network interface. The first benefit that comes to my mind is that planning for multiple addresses sets you up for easy changes to your network architecture in the future. It might make sense to combine all of these services onto one device today, but that might not always be the case depending on your requirements.</p>
<h3 id="install-bind-on-the-router">Install BIND on the router<a class="headerlink" href="#install-bind-on-the-router" title="Permanent link">&para;</a></h3>
<p><strong>BIND</strong> (also referred to as <em>named</em>) is a robust and versatile DNS implementation developed by the <em>Internet Services Consortium (ISC)</em> -- the same folks that developed the DHCP server implementation we have deployed. The first version of BIND was released in 1986. At present, BIND 9 is the most widely deployed DNS server on the Internet.</p>
<p>BIND and related utilities are packaged in the Debian/Raspbian software repositories, meaning that they can be installed and managed easily with the <code>apt</code> utilities that we are already familiar with. For our purposes, we want to install three different packages named <code>bind9</code>, <code>bind9utils</code>, <code>bind9-doc</code>. Please refer to previous guides if you need to review the options for the <code>apt</code> command.</p>
<h3 id="configure-bind-as-a-caching-dns-server">Configure BIND as a caching DNS server<a class="headerlink" href="#configure-bind-as-a-caching-dns-server" title="Permanent link">&para;</a></h3>
<p>The term <em>DNS server</em> can refer to several distinct roles that are defined in the DNS specifications<sup id="fnref:server-types"><a class="footnote-ref" href="#fn:server-types">1</a></sup>. BIND can be configured to operate in all of these roles, but in this checkpoint, we want to configure the service to handle recursive DNS resolution for our LAN clients. Until now, our clients relied on public DNS services. </p>
<p>To accomplish this objective, refer to the section of Digital Ocean's tutorial<sup id="fnref:tutorial"><a class="footnote-ref" href="#fn:tutorial">2</a></sup>, which demonstrates how to set up a caching DNS server (be sure to stop after this section) and the notes below.</p>
<p>You will need to make several adjustments to the configuration you created based on DO's guidance:</p>
<ol>
<li>Confirm that you have adapted the instructions to use your own IP address ranges.</li>
<li>Disable IPv6 by changing <code>listen-on-v6 { any; };</code> to <code>listen-on-v6 { none; };</code>.</li>
<li>Limit which IPv4 addresses will be listening for DNS queries by setting <code>listen-on { 127.0.0.1; &lt;DNS IP&gt;; }</code>.<ul>
<li><strong><code>&lt;DNS IP&gt;</code></strong> will be replaced by the static IP on which you want to respond to DNS requests</li>
<li>If the <code>listen-on</code> block is missing from the original file, you can add it immediately before or after <code>listen-on-v6</code>.</li>
<li>127.0.0.1 is the loopback address. We're including this for times that your Pi will query its own resolver.</li>
</ul>
</li>
<li>Restrict the <code>acl</code> to include <code>localhost</code> and your own subnet range (CIDR format)<ul>
<li>If you added <code>localnets</code> while following the tutorial, remove it now. This setting would allow the resolver to be accessed on the external (wireless network) as well as your LAN.</li>
<li>If you're curious to learn more about this security precaution, read up on <strong>Cache Poisoning Attacks</strong> or hit us up in office hours.</li>
</ul>
</li>
<li>Disable DNSSEC functionality by replacing the configuration line that reads <code>dnssec-validation auto;</code> with <code>dnssec-enable no;</code>.<ul>
<li>Disabling DNSSEC is necessary due to the limitations of using a Pi versus an always on network server.</li>
<li>Specifically, the inability of the Pi to maintain accurate time when it is powered off interferes with the verification process for DNSSEC cryptographic signatures</li>
</ul>
</li>
</ol>
<h3 id="test-and-verify-that-the-new-server-is-operating-properly">Test and verify that the new server is operating properly<a class="headerlink" href="#test-and-verify-that-the-new-server-is-operating-properly" title="Permanent link">&para;</a></h3>
<p>In addition to the troubleshooting tools that we're already familiar with. BIND comes with a utility called <code>named-checkconf</code> that will review its core configuration files for syntax errors. You should run it any time you modify the BIND configuration in this assignment or future checkpoints.</p>
<div class="admonition faq">
<p class="admonition-title">Why didn't <code>named-checkconf</code> do anything</p>
<p>If it doesn't find any syntax errors in your configuration files, <code>named-checkconf</code> will return without displaying any messages. To see what sort of errors are reported by the utility, create an intentional syntax error and run the tool again.</p>
</div>
<p>Once your files are free of errors, use <code>systemctl</code> to restart the <code>bind9</code> service and check that it's working with <code>dig</code>, e.g., <code>dig @127.0.0.1 washington.edu</code>. As we've discussed in other places, the <code>@IP</code> syntax of <code>dig</code> is used to override local resolver settings (which are still determined by DHCP on the wifi network).</p>
<h3 id="update-your-dhcp-server-configuration">Update your DHCP Server Configuration<a class="headerlink" href="#update-your-dhcp-server-configuration" title="Permanent link">&para;</a></h3>
<p>To wrap up this project, you will need to update the DHCP server configuration so that LAN users will receive the address for the local resolver instead of the public resolver we previously used:</p>
<ol>
<li>Update DHCP server configuration so that your Pi will be used as the domain name server for the LAN</li>
<li>Use systemctl to restart the DHCP server daemon</li>
<li>Manually renew your DHCP configuration on your PC through the OS or by temporarily disconnecting the network cable </li>
<li>Verify that your computer receives the updated parameters from DHCP</li>
</ol>
<div class="footnote">
<hr />
<ol>
<li id="fn:server-types">
<p>See <a href="https://www.digitalocean.com/community/tutorials/a-comparison-of-dns-server-types-how-to-choose-the-right-dns-configuration">A Comparison of DNS Server Types</a>&#160;<a class="footnote-backref" href="#fnref:server-types" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:tutorial">
<p>See <a href="https://www.digitalocean.com/community/tutorials/how-to-configure-bind-as-a-caching-or-forwarding-dns-server-on-ubuntu-16-04">How to Configure Bind as a Caching or Forwarding DNS Server</a>&#160;<a class="footnote-backref" href="#fnref:tutorial" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
</ol>
</div></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2020 Daniel Schwalbe</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
